<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Text-to-Emoji Translator ✨</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 36px; background:#f1d7b3; color:#6b4400c2; text-align:center; }
    textarea { width:80%; max-width:900px; height:100px; font-size:16px; padding:10px; border-radius:6px; border:1px solid #ddd; }
    button { margin-top:12px; padding:10px 16px; font-size:16px; border-radius:6px; cursor:pointer; }
    .output { margin-top:18px; font-size:20px; min-height:48px; padding:10px; background:white; display:inline-block; max-width:90%; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.06); }
    .debug { margin-top:10px; color:#b33; font-size:13px; }
    .hint { margin-top:6px; color:#666; font-size:13px; }
  </style>
</head>
<body>
  <h1>Text-to-Emoji Translator</h1>
  <p>Type text and click <strong>Translate</strong> (or press <em>Ctrl/Cmd + Enter</em>)</p>

  <textarea id="inputText" placeholder="Try: I love pizza and my cat."></textarea><br>
  <button id="translateBtn">Translate</button>

  <div class="output" id="output">Translated text will appear here.</div>
  <div class="debug" id="debug" aria-live="polite"></div>
  <div class="hint">Tip: punctuation (like . , ! ?) is handled — try "The sun, moon, and stars!"</div>

  <script>
  // -------------------------
  // emojiMap: word (lowercase) => emoji
  let emojiMap = {};
  const btn = document.getElementById('translateBtn');
  btn.disabled = true; // disable at start

  fetch("emoji-dictionary.json")
    .then(response => response.json())
    .then(data => {
      data.forEach(item => {
        // use full name instead of just first word for better matches
        let key = item.name.toLowerCase();
        emojiMap[key] = item.char;
      });
      btn.disabled = false; // enable after loading
      console.log("Emoji map loaded:", Object.keys(emojiMap).length, "entries");
    })
    .catch(err => console.error("Failed to load emoji dictionary:", err));

  // Helpful small helper to show debug messages on the page
  function showDebug(msg, isError = true) {
    const el = document.getElementById('debug');
    el.textContent = msg || '';
    if (isError && msg) console.error(msg);
    else if (msg) console.log(msg);
  }

  // Translation function
  function translate(text) {
    // split into words while keeping punctuation as tokens
    let tokens = text.toLowerCase().split(/(\b|\s+)/);
    let translated = tokens.map(tok => {
      let clean = tok.replace(/[.,!?]/g, ""); // strip punctuation for lookup
      return emojiMap[clean] || tok;
    });
    return translated.join("");
  }

  // wire up UI after DOM loads
  (function init() {
    try {
      const btn = document.getElementById('translateBtn');
      const input = document.getElementById('inputText');
      const output = document.getElementById('output');

      if (!btn || !input || !output) {
        showDebug('UI elements not found — check element ids in the HTML.', true);
        return;
      }

      // button click -> translate
      btn.addEventListener('click', () => {
        try {
          const raw = input.value.trim();
          const translated = translate(raw);
          output.textContent = translated || '(empty)';
          showDebug('', false); // clear debug on success
          console.log('Translated:', translated);
        } catch (err) {
          showDebug('Translate error: ' + err.message, true);
        }
      });

      // keyboard shortcut: Ctrl/Cmd + Enter to translate
      input.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          btn.click();
        }
      });

      // optional: auto-clear debug when user focuses input
      input.addEventListener('focus', () => { showDebug('', false); });

      console.log('Text-to-Emoji script loaded successfully.');
      showDebug('', false);
    } catch (err) {
      showDebug('Initialization failed: ' + err.message, true);
    }
  })();
</script>

</body>
</html>
